---
title: "AS_Translocation"
author: "IP"
date: "2024-09-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tidyverse)

#Plot setup
bp_fill<- c("#FEEB8A", "#A6D8F2")
bp_col<- c("#FFC600", "#004687")
point = 2
axis_font_size = 12
axis_title_size = 14
```

Salmonella colonization in the feces after PEG over 6 days
```{r}
data <- "PEG_F0_Salmonella_Counts.csv"
feces_long <- read_csv(data) %>% 
  pivot_longer(cols = starts_with("Day"), names_to="Day", values_to = "feces_CFU")%>%
  mutate(Day = recode(Day, "Day_1" = "1", "Day_2" = "2", "Day_3" = "3",
                      "Day_4"="4","Day_5"="5","Day_6"="6")) %>% 
  mutate(feces_LOD = ifelse(feces_CFU > 100, "above", "below")) %>% 
  drop_na(., feces_LOD) %>% 
  mutate(Treatment = factor(Treatment, levels = c("PEG", "MB-")))

feces <- feces_long %>% 
  ggplot(aes(x = Day, y = feces_CFU, fill = Treatment)) +
  geom_violin(color = NA, scale = "width", width = 0.8) +  
  geom_point(position = position_jitterdodge(), aes(color = Treatment)) +
  labs(
    x = "Day", 
    y = "Salmonella Counts in Feces (CFU/mL)", 
    fill = "", colour = ""
  ) +
  geom_hline(yintercept = 100, colour = "red", linetype = "dashed") +
  theme_bw() +
  scale_fill_manual(values = bp_fill) +  # Fill color for the violins
  scale_color_manual(values = bp_col) +  # Fill color for the points
  scale_y_log10(limits = c(1e0, 1e8), labels = scales::trans_format(log10, scales::math_format(10^.x))) +
  theme(
    panel.border = element_rect(color = "black"),
    panel.grid = element_line(colour = "white"),
    axis.title = element_text(size = axis_title_size, colour = "black"), 
    strip.text.x = element_blank(),
    axis.text = element_text(size = axis_font_size, colour = "black"),
    # legend.position = c(0.88,0.90)
  ) +
  ggtitle("Salmonella in feces of MB- or conventional PEG+")

feces

# Wilcoxon/Mann-Whitney test (two groups, non-parametric as not-normal)
days <- unique(feces_long$Day)
for (d in days){
  dat <- feces_long[feces_long$Day==d,]
  wmn <- wilcox.test(feces_CFU ~ Treatment, data=dat, exact=FALSE)
  wmn_p <- wmn$p.value
  print(paste("Wilcoxon/MW p-value for day",d,"is",wmn_p,sep=" "))
}

# ggsave("Feces_Colonization.pdf", feces, device = "pdf", height = 4.90, width = 6)

```

Salmonella translocation in the tissues after 6 days of PEG + infection
```{r}
tissue_long<- read_csv(data) %>% 
  pivot_longer(cols = c("mLN", "Spleen", "Liver","Cecum"), names_to="Tissue", values_to = "tissue_CFU")%>%
  mutate(Treatment = factor(Treatment, levels = c("PEG", "MB-"))) %>% 
  mutate(Tissue = factor(Tissue, levels = c("mLN", "Spleen", "Liver","Cecum")))

tissue <- ggplot() +
  geom_violin(data = tissue_long, aes(x = Treatment, y = tissue_CFU, fill = Treatment), color = NA, scale = "width", width = 0.8,drop=FALSE) +
  geom_point(data = tissue_long, aes(x = Treatment, y = tissue_CFU, color = Treatment),
    position = position_jitterdodge(jitter.width = 0.4, dodge.width = 0.9),
    size = point, alpha = 1) +
  labs(x = "", y = "Salmonella Counts in Tissues (CFU/g)",fill="",color="") +
  theme_bw() + 
  facet_grid(~Tissue)+
  theme_bw() +
  scale_fill_manual(values = bp_fill) +  # Fill color for the violins
  scale_color_manual(values = bp_col) +  # Fill color for the points
  scale_y_log10(limits = c(1e0, 1e7), labels = scales::trans_format(log10, scales::math_format(10^.x))) +
theme(
    panel.border = element_rect(color = "black"),
    panel.grid = element_line(colour = "white"),
    axis.title = element_text(size = axis_title_size, colour = "black"), 
    axis.text = element_text(size = axis_font_size, colour = "black"),
    strip.text = element_text(size = axis_title_size, colour = 'black'),
    # legend.position = c(0.88,0.90),
    strip.text.x = element_text(size = axis_title_size, colour = 'black'),  
    strip.background = element_blank(),  # Remove background
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank()
  ) +
  ggtitle("Salmonella translocation at 6 days post-infection")
tissue

tissues <- unique(tissue_long$Tissue)
for (t in tissues){
  dat <- tissue_long[tissue_long$Tissue==t,]
  wmn <- wilcox.test(tissue_CFU ~ Treatment, data=dat, exact=FALSE)
  wmn_p <- wmn$p.value
  print(paste("Wilcoxon/MW p-value for tissue",t,"is",wmn_p,sep=" "))
}

# ggsave("Tissue_Colonization.pdf", tissue, device = "pdf", height = 4.90, width = 6)


```

Weight loss after infection
```{r}
data <- "weight_loss_data_F0_salmonella_sac.csv"
weight <- read_csv(data) %>%
    mutate(Treatment = factor(Treatment, levels = c("PEG", "MB-"))) 
  
weight_summ <- weight %>%
  group_by(Treatment,Day) %>% 
  summarise(mean=mean(Percent_Change), stdev=sd(Percent_Change))
weight_summ

weigh_plot <- weight_summ %>% 
  ggplot(aes(x=Day,y=mean,group=Treatment,color=Treatment)) +
  theme_bw() +
  scale_fill_manual(values = bp_fill) +  # Fill color for the violins
  scale_color_manual(values = bp_col) +  # Fill color for the points
  geom_ribbon(aes(y = mean, ymin = mean-stdev, ymax = mean+stdev, fill = Treatment), 
              alpha = .3, color=NA) +
  geom_point() + geom_line() +
  ggtitle("Mouse % weight change following Salmonella infection") +
  labs(x="Day",y="Mean % weight change")

weigh_plot
ggsave("weight_change.pdf",weigh_plot, device = "pdf", height = 4.90, width = 6)
```